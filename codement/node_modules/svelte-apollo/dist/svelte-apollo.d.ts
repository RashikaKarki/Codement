/// <reference types="zen-observable" />
import { ApolloClient, FetchResult, MutationOptions, ObservableQuery, WatchQueryOptions, OperationVariables, DataProxy, SubscriptionOptions } from '@apollo/client';
import { DocumentNode } from 'graphql';
import { ApolloError } from '@apollo/client/core';
import { Readable } from 'svelte/store';

declare function getClient<TCache = any>(): ApolloClient<TCache>;
declare function setClient<TCache = any>(client: ApolloClient<TCache>): void;

declare type MutateOptions<T = unknown, TVariables = unknown> = Omit<MutationOptions<T, TVariables>, "mutation">;
declare type Mutate<T = unknown, TVariables = unknown> = (options: MutateOptions<T, TVariables>) => Promise<FetchResult<T>>;
declare function mutation<T = unknown, TVariables = unknown>(mutation: DocumentNode): Mutate<T, TVariables>;

interface Loading {
    loading: true;
    data?: undefined;
    error?: undefined;
}
interface Error {
    loading: false;
    data?: undefined;
    error: ApolloError | Error;
}
interface Data<TData = unknown> {
    loading: false;
    data: TData | null | undefined;
    error?: undefined;
}
declare type Result<TData = unknown> = Loading | Error | Data<TData>;
declare type ReadableResult<TData = unknown> = Readable<Result<TData>>;
interface ObservableQueryExtensions {
    fetchMore: ObservableQuery["fetchMore"];
    getCurrentResult: ObservableQuery["getCurrentResult"];
    getLastError: ObservableQuery["getLastError"];
    getLastResult: ObservableQuery["getLastResult"];
    isDifferentFromLastResult: ObservableQuery["isDifferentFromLastResult"];
    refetch: ObservableQuery["refetch"];
    resetLastResults: ObservableQuery["resetLastResults"];
    resetQueryStoreErrors: ObservableQuery["resetQueryStoreErrors"];
    result: ObservableQuery["result"];
    setOptions: ObservableQuery["setOptions"];
    setVariables: ObservableQuery["setVariables"];
    startPolling: ObservableQuery["startPolling"];
    stopPolling: ObservableQuery["stopPolling"];
    subscribeToMore: ObservableQuery["subscribeToMore"];
    updateQuery: ObservableQuery["updateQuery"];
}
declare type ReadableQuery<TData> = ReadableResult<TData> & ObservableQueryExtensions;

declare function query<TData = unknown, TVariables = unknown>(query: DocumentNode, options?: Omit<WatchQueryOptions<TVariables, TData>, "query">): ReadableQuery<TData>;

declare function restore<TData = unknown, TVariables = OperationVariables>(query: DocumentNode, options: Omit<DataProxy.WriteQueryOptions<TData, TVariables>, "query">): void;

declare function subscribe<TData = unknown, TVariables = unknown>(query: DocumentNode, options?: Omit<SubscriptionOptions<TVariables>, "query">): ReadableResult<TData>;

export { ReadableQuery, ReadableResult, Result, getClient, mutation, query, restore, setClient, subscribe };
